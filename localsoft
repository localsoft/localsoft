#!/usr/bin/env bash

# TODO: ensure node, yarn installed globally

# Create runtime directories if not exist.
mkdir -p .data

# Install dependencies.
yarn -s
(cd client && yarn -s)
(cd server && yarn -s)

# Start either branch depending on production flag
if [ "$1" == "--production" ]
then
    export NODE_ENV="production"
    (cd client && yarn build && mv build ../.build)     # move build dir to this path
    cd server
    yarn -s start
else
    yarn -s
    node_modules/.bin/concurrently "cd client && yarn start" "cd server && yarn start"
fi
